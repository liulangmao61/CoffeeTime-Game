# 《咖啡时光》产品需求文档（PRD）

## 1. 产品概述

### 1.1 产品定位

《咖啡时光》是一款面向职场人士的模拟经营类休闲游戏，通过经营虚拟咖啡馆的模式，为用户在工作间隙提供轻松解压的娱乐体验。产品定位于"治愈系办公摸鱼游戏"，主打温馨治愈、节奏舒缓、操作简单的特点。

### 1.2 核心价值主张

- **解压治愈**：通过模拟制作咖啡的流程，帮助用户在紧张的工作环境中获得短暂的放松
- **成就感满足**：通过店铺升级、解锁新配方等成长系统，满足用户的成就感需求
- **碎片化娱乐**：单局时长控制在10-15分钟，适合在工作间隙快速体验
- **个性化表达**：丰富的装饰系统，让用户打造专属的咖啡馆

### 1.3 目标用户群体

- **主要用户**：28-40岁职场人士，以白领为主
- **用户特征**：
  - 工作压力较大，需要解压方式
  - 对咖啡文化有一定兴趣
  - 喜欢模拟经营类游戏
  - 有碎片化娱乐需求
- **使用场景**：午休时间、通勤路上、工作间隙

### 1.4 业务指标（KPI）

- **DAU（日活跃用户）**：目标3个月内达到10万
- **次日留存率**：目标≥40%
- **7日留存率**：目标≥20%
- **月活跃用户**：目标3个月内达到50万
- **平均单次使用时长**：目标8-12分钟
- **付费转化率**：目标2-5%

---

## 2. 功能模块说明

### 2.1 用户系统模块

#### 2.1.1 用户注册/登录（P0）

- **功能描述**：支持手机号、微信、QQ等多渠道注册登录
- **业务规则**：
  - 首次登录自动创建用户档案
  - 支持游客模式，引导用户注册
  - 本地缓存用户数据，离线可继续游戏
- **优先级**：P0

#### 2.1.2 个人资料管理（P1）

- **功能描述**：编辑昵称、头像、个性签名等个人信息
- **业务规则**：
  - 昵称长度限制1-12字符
  - 头像支持上传和系统头像选择
  - 支持社交功能展示
- **优先级**：P1

### 2.2 咖啡制作系统模块

#### 2.2.1 配方学习（P0）

- **功能描述**：学习和解锁新的咖啡配方
- **业务规则**：
  - 新手引导解锁基础3款配方
  - 通过完成订单获得经验解锁高级配方
  - 每种配方有独特制作流程
- **优先级**：P0

#### 2.2.2 咖啡制作流程（P0）

- **功能描述**：拖拽原料制作咖啡，模拟真实制作过程
- **业务规则**：
  - 拖拽正确原料到咖啡杯中
  - 按配方要求完成制作步骤
  - 制作时间限制，超时失败
  - 根据制作准确度获得不同评分
- **优先级**：P0

#### 2.2.3 原料管理（P0）

- **功能描述**：管理咖啡豆、牛奶、糖浆等制作原料
- **业务规则**：
  - 原料不足时自动补充
  - 支持批量购买原料
  - 不同等级原料影响咖啡品质
- **优先级**：P0

### 2.3 顾客服务系统模块

#### 2.3.1 顾客订单（P0）

- **功能描述**：接收顾客订单并完成制作
- **业务规则**：
  - 顾客随机出现，有不同等待时间
  - 订单类型包括基础咖啡、定制咖啡
  - 按时完成获得奖励，超时扣分
- **优先级**：P0

#### 2.3.2 顾客类型系统（P0）

- **功能描述**：不同类型的顾客有不同的需求和行为
- **业务规则**：
  - 普通顾客：基础订单，等待时间适中
  - VIP顾客：高价值订单，要求更严格
  - 特殊顾客：有特殊需求，完成后获得额外奖励
- **优先级**：P0

#### 2.3.3 服务质量评价（P1）

- **功能描述**：根据服务质量和咖啡品质获得顾客评价
- **业务规则**：
  - 评价影响顾客满意度
  - 满意度影响顾客回头率
  - 高评价获得额外金币奖励
- **优先级**：P1

### 2.4 店铺管理系统模块

#### 2.4.1 店铺升级（P0）

- **功能描述**：通过金币升级店铺等级，解锁新功能
- **业务规则**：
  - 每级升级需要消耗固定金币
  - 升级后解锁新区域、新功能
  - 等级越高，每日收益越高
- **优先级**：P0

#### 2.4.2 设备升级（P0）

- **功能描述**：升级咖啡机、磨豆机等设备提升效率
- **业务规则**：
  - 设备等级影响制作速度和品质
  - 高级设备解锁高级配方制作
  - 升级需要消耗金币和时间
- **优先级**：P0

#### 2.4.3 员工雇佣（P1）

- **功能描述**：雇佣员工协助制作咖啡，提升效率
- **业务规则**：
  - 不同员工有不同技能特长
  - 员工需要支付工资
  - 员工等级可提升，技能可学习
- **优先级**：P1

### 2.5 装饰系统模块

#### 2.5.1 装饰购买（P1）

- **功能描述**：购买各种装饰品美化咖啡馆
- **业务规则**：
  - 装饰品分类：家具、装饰、植物、灯光等
  - 不同装饰有不同价格和效果
  - 装饰影响顾客满意度
- **优先级**：P1

#### 2.5.2 布局编辑（P1）

- **功能描述**：自由摆放装饰品，个性化定制咖啡馆
- **业务规则**：
  - 支持拖拽移动装饰品
  - 支持旋转、缩放装饰品
  - 保存布局设置
- **优先级**：P1

### 2.6 成就系统模块

#### 2.6.1 成就解锁（P1）

- **功能描述**：完成特定任务解锁成就，获得奖励
- **业务规则**：
  - 日常成就：每日登录、制作10杯咖啡等
  - 进阶成就：制作特定配方、升级店铺等
  - 稀有成就：特殊条件解锁
- **优先级**：P1

#### 2.6.2 成就奖励（P1）

- **功能描述**：完成成就获得金币、装饰品等奖励
- **业务规则**：
  - 不同成就奖励不同
  - 连续成就解锁有额外奖励
  - 成就奖励可重复获得
- **优先级**：P1

### 2.7 社交系统模块

#### 2.7.1 好友系统（P2）

- **功能描述**：添加好友，互相访问咖啡馆
- **业务规则**：
  - 支持搜索和推荐好友
  - 可访问好友咖啡馆获得奖励
  - 好友互动增加游戏趣味性
- **优先级**：P2

#### 2.7.2 排行榜（P2）

- **功能描述**：展示玩家排名，增加竞争性
- **业务规则**：
  - 按店铺等级、金币数量等排序
  - 每周重置排行榜
  - 排行榜奖励发放
- **优先级**：P2

---

## 3. 交互流程设计

### 3.1 核心用户流程图

```
用户启动游戏
    ↓
[登录/注册] → [游客模式]
    ↓
进入主界面 → [咖啡制作] [店铺管理] [装饰系统] [成就系统]
    ↓
咖啡制作流程：
    接收订单 → 选择配方 → 拖拽原料 → 完成制作 → 获得奖励
    ↓
店铺升级流程：
    获得金币 → 选择升级 → 消耗资源 → 完成升级
    ↓
装饰流程：
    购买装饰 → 选择布局 → 摆放装饰 → 保存设置
```

### 3.2 详细交互流程

#### 3.2.1 咖啡制作流程

1. **触发条件**：顾客到达咖啡馆
2. **用户操作**：点击顾客查看订单
3. **系统响应**：
   - 显示订单详情（咖啡类型、特殊要求）
   - 进入制作界面
   - 启动计时器
4. **用户操作**：拖拽原料到咖啡杯
5. **系统验证**：
   - 检查原料是否正确
   - 检查制作步骤是否完整
6. **结果处理**：
   - 成功：获得金币奖励，顾客满意离开
   - 失败：扣除金币，顾客不满意离开
7. **异常处理**：
   - 超时：自动失败，扣除金币
   - 原料不足：提示补充原料

#### 3.2.2 店铺升级流程

1. **触发条件**：用户点击升级按钮
2. **系统验证**：
   - 检查金币是否充足
   - 检查前置条件是否满足
3. **用户确认**：确认升级操作
4. **系统执行**：
   - 扣除金币
   - 开始升级动画
   - 设置升级完成时间
5. **结果处理**：
   - 升级完成后更新店铺属性
   - 解锁新功能

### 3.3 状态转换逻辑

```
游戏状态转换：
[空闲状态] ←→ [制作状态] ←→ [升级状态] ←→ [装饰状态]
    ↑              ↓
[暂停状态] ←←→ [设置状态]
```

---

## 4. 界面原型描述

### 4.1 主界面布局

#### 4.1.1 主界面（咖啡馆场景）

- **布局结构**：
  - 顶部：用户信息、金币数量、游戏设置
  - 中部：咖啡馆场景，展示顾客、员工、设备
  - 底部：功能导航栏（制作、升级、装饰、成就）
- **元素位置**：
  - 顾客区：场景右侧，顾客排队等待
  - 制作区：场景中央，咖啡制作台
  - 设备区：场景左侧，咖啡机、磨豆机等
- **交互反馈**：
  - 点击顾客：弹出订单详情
  - 点击设备：进入制作界面
  - 拖拽操作：实时反馈

#### 4.1.2 咖啡制作界面

- **布局结构**：
  - 顶部：订单详情、计时器
  - 左侧：原料区（咖啡豆、牛奶、糖浆等）
  - 中央：制作区域（咖啡杯、制作步骤）
  - 右侧：配方提示、完成按钮
- **控件类型**：
  - 拖拽控件：原料可拖拽到制作区
  - 按钮控件：完成制作、取消制作
  - 进度条：制作进度显示
- **视觉设计**：
  - 背景：温暖的咖啡色调
  - 原料图标：拟物化设计，清晰易识别
  - 动画效果：拖拽时的轨迹动画

#### 4.1.3 店铺管理界面

- **布局结构**：
  - 顶部：店铺等级、金币余额
  - 左侧：升级选项列表（设备、店铺、员工）
  - 右侧：详细信息和升级按钮
- **控件类型**：
  - 选项卡：切换不同升级类型
  - 滑块：选择升级等级
  - 按钮：确认升级操作
- **交互反馈**：
  - 悬停显示详细信息
  - 升级过程中显示进度条
  - 金币不足时按钮置灰

### 4.2 视觉设计规范

#### 4.2.1 色彩规范

- **主色调**：暖咖啡色 #8B4513
- **辅助色**：米白色 #F5F5DC
- **强调色**：橙色 #FFA500
- **背景色**：浅灰色 #F0F0F0
- **文字色**：深灰色 #333333

#### 4.2.2 字体规范

- **标题字体**：思源黑体 Bold 18px
- **正文字体**：思源黑体 Regular 14px
- **提示字体**：思源黑体 Light 12px

#### 4.2.3 图标规范

- **风格**：线性图标，圆角设计
- **尺寸**：24x24px 基础规格
- **颜色**：主色调 #8B4513

---

## 5. 数据规范与接口定义

### 5.1 数据模型

#### 5.1.1 用户数据表（users）

| 字段名     | 类型      | 长度 | 约束                                | 说明     |
| ---------- | --------- | ---- | ----------------------------------- | -------- |
| id         | INT       | -    | PRIMARY KEY, AUTO_INCREMENT         | 用户ID   |
| username   | VARCHAR   | 20   | UNIQUE, NOT NULL                    | 用户名   |
| phone      | VARCHAR   | 11   | UNIQUE                              | 手机号   |
| avatar     | VARCHAR   | 255  | -                                   | 头像URL  |
| coins      | INT       | -    | DEFAULT 0                           | 金币数量 |
| level      | INT       | -    | DEFAULT 1                           | 店铺等级 |
| exp        | INT       | -    | DEFAULT 0                           | 经验值   |
| created_at | TIMESTAMP | -    | DEFAULT CURRENT_TIMESTAMP           | 创建时间 |
| updated_at | TIMESTAMP | -    | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

#### 5.1.2 咖啡配方表（recipes）

| 字段名      | 类型      | 长度 | 约束                        | 说明           |
| ----------- | --------- | ---- | --------------------------- | -------------- |
| id          | INT       | -    | PRIMARY KEY, AUTO_INCREMENT | 配方ID         |
| name        | VARCHAR   | 50   | NOT NULL                    | 配方名称       |
| ingredients | JSON      | -    | NOT NULL                    | 原料列表       |
| difficulty  | INT       | -    | DEFAULT 1                   | 难度等级(1-5)  |
| unlock_exp  | INT       | -    | DEFAULT 0                   | 解锁所需经验值 |
| price       | INT       | -    | DEFAULT 0                   | 制作价格       |
| created_at  | TIMESTAMP | -    | DEFAULT CURRENT_TIMESTAMP   | 创建时间       |

#### 5.1.3 用户库存表（inventory）

| 字段名     | 类型      | 长度 | 约束                        | 说明                                   |
| ---------- | --------- | ---- | --------------------------- | -------------------------------------- |
| id         | INT       | -    | PRIMARY KEY, AUTO_INCREMENT | 库存ID                                 |
| user_id    | INT       | -    | FOREIGN KEY                 | 用户ID                                 |
| item_type  | VARCHAR   | 20   | NOT NULL                    | 物品类型(recipe/ingredient/decoration) |
| item_id    | INT       | -    | NOT NULL                    | 物品ID                                 |
| quantity   | INT       | -    | DEFAULT 1                   | 数量                                   |
| created_at | TIMESTAMP | -    | DEFAULT CURRENT_TIMESTAMP   | 创建时间                               |

### 5.2 API接口定义

#### 5.2.1 用户相关接口

**接口1：用户登录**

- **路径**：POST /api/v1/auth/login
- **请求参数**：

```json
{
  "username": "string",
  "password": "string"
}
```

- **响应格式**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "string",
    "user": {
      "id": 1,
      "username": "string",
      "coins": 1000,
      "level": 1
    }
  }
}
```

- **错误码**：
  - 401: 用户名或密码错误
  - 404: 用户不存在

**接口2：获取用户信息**

- **路径**：GET /api/v1/user/profile
- **请求头**：Authorization: Bearer {token}
- **响应格式**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "string",
    "avatar": "string",
    "coins": 1000,
    "level": 1,
    "exp": 0
  }
}
```

#### 5.2.2 咖啡制作相关接口

**接口3：获取配方列表**

- **路径**：GET /api/v1/recipes
- **请求头**：Authorization: Bearer {token}
- **响应格式**：

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "美式咖啡",
      "ingredients": ["咖啡豆", "水"],
      "difficulty": 1,
      "unlocked": true
    }
  ]
}
```

**接口4：制作咖啡**

- **路径**：POST /api/v1/coffee/make
- **请求参数**：

```json
{
  "recipe_id": 1,
  "ingredients": ["咖啡豆", "水"]
}
```

- **响应格式**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "success": true,
    "rating": 5,
    "reward_coins": 100
  }
}
```

#### 5.2.3 店铺管理相关接口

**接口5：升级店铺**

- **路径**：POST /api/v1/shop/upgrade
- **请求参数**：

```json
{
  "upgrade_type": "shop|equipment|employee",
  "item_id": 1
}
```

- **响应格式**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "new_level": 2,
    "cost": 500,
    "remaining_coins": 500
  }
}
```

### 5.3 错误码规范

| 错误码 | 说明           | HTTP状态码 |
| ------ | -------------- | ---------- |
| 1000   | 成功           | 200        |
| 2001   | 用户未登录     | 401        |
| 2002   | 用户不存在     | 404        |
| 2003   | 金币不足       | 400        |
| 2004   | 配方未解锁     | 403        |
| 2005   | 原料不足       | 400        |
| 3001   | 服务器内部错误 | 500        |
| 3002   | 请求参数错误   | 400        |

---

## 6. 非功能性需求

### 6.1 性能要求

#### 6.1.1 页面加载性能

- **首页加载时间**：≤3秒（4G网络环境下）
- **页面切换时间**：≤1秒
- **资源包大小**：首次加载≤5MB，后续更新≤1MB
- **内存占用**：≤100MB（移动端）

#### 6.1.2 接口响应性能

- **接口响应时间**：≤500ms（95%请求）
- **并发处理能力**：≥1000 QPS
- **数据库查询时间**：≤100ms（复杂查询≤500ms）

#### 6.1.3 游戏性能

- **帧率**：≥30FPS（移动端），≥60FPS（PC端）
- **动画流畅度**：无明显卡顿，动画过渡自然
- **内存管理**：定期清理无用资源，避免内存泄漏

### 6.2 安全标准

#### 6.2.1 用户认证机制

- **登录认证**：JWT Token机制，有效期24小时
- **Token刷新**：自动刷新机制，防止频繁登录
- **多设备登录**：支持单设备登录，踢出旧设备

#### 6.2.2 数据加密策略

- **敏感数据加密**：用户密码使用BCrypt加密存储
- **传输加密**：所有API请求使用HTTPS协议
- **本地数据加密**：重要数据本地存储使用AES加密

#### 6.2.3 权限控制规则

- **接口权限**：不同接口设置不同权限级别
- **数据权限**：用户只能访问自己的数据
- **操作权限**：关键操作需要二次确认

#### 6.2.4 防攻击措施

- **防刷机制**：限制API调用频率，防止恶意刷取
- **SQL注入防护**：使用预编译语句，参数化查询
- **XSS防护**：输入输出过滤，防止脚本注入

### 6.3 兼容性范围

#### 6.3.1 操作系统兼容性

- **移动端**：iOS 12.0+，Android 7.0+
- **PC端**：Windows 10+，macOS 10.14+
- **浏览器**：Chrome 80+，Safari 13+，Firefox 75+

#### 6.3.2 设备兼容性

- **屏幕尺寸**：支持4.7"-6.7"手机屏幕
- **分辨率**：支持720p-1080p分辨率
- **横竖屏**：仅支持竖屏模式

---

## 7. 验收标准

### 7.1 功能验收标准

#### 7.1.1 用户系统验收标准

- **注册登录**：
  - [ ] 用户可以成功注册账号
  - [ ] 用户可以使用多种方式登录
  - [ ] 登录状态保持24小时
  - [ ] Token过期后自动跳转登录页
- **个人资料**：
  - [ ] 用户可以修改昵称、头像
  - [ ] 修改信息后立即生效
  - [ ] 信息格式验证正确

#### 7.1.2 咖啡制作系统验收标准

- **配方学习**：
  - [ ] 新手引导解锁基础配方
  - [ ] 通过制作获得经验解锁新配方
  - [ ] 配方列表显示正确
- **制作流程**：
  - [ ] 拖拽操作流畅无卡顿
  - [ ] 制作时间限制准确
  - [ ] 评分系统合理
  - [ ] 成功/失败反馈及时
- **原料管理**：
  - [ ] 原料数量显示正确
  - [ ] 自动补充机制有效
  - [ ] 批量购买功能正常

#### 7.1.3 顾客服务系统验收标准

- **订单系统**：
  - [ ] 顾客随机出现
  - [ ] 订单信息显示完整
  - [ ] 超时处理正确
  - [ ] 奖励发放准确
- **顾客类型**：
  - [ ] 不同顾客类型表现正确
  - [ ] 特殊需求处理准确
  - [ ] 满意度系统正常

#### 7.1.4 店铺管理系统验收标准

- **升级系统**：
  - [ ] 金币扣除正确
  - [ ] 升级进度显示准确
  - [ ] 新功能解锁及时
  - [ ] 升级动画流畅
- **设备管理**：
  - [ ] 设备等级影响制作效率
  - [ ] 升级条件验证正确
  - [ ] 设备效果提升明显

### 7.2 性能验收标准

- [ ] 首页加载时间≤3秒
- [ ] 页面切换时间≤1秒
- [ ] 接口响应时间≤500ms
- [ ] 游戏帧率≥30FPS
- [ ] 内存占用≤100MB

### 7.3 安全验收标准

- [ ] 用户认证机制有效
- [ ] 数据传输加密
- [ ] 敏感数据加密存储
- [ ] 防刷机制有效
- [ ] SQL注入防护有效

### 7.4 兼容性验收标准

- [ ] iOS 12.0+系统正常运行
- [ ] Android 7.0+系统正常运行
- [ ] Chrome 80+浏览器正常运行
- [ ] 不同屏幕尺寸适配良好

---

## 8. 项目排期计划

### 8.1 研发阶段划分

#### 第一阶段：基础功能开发（4周）

- **时间**：第1-4周
- **目标**：完成核心功能开发
- **交付物**：
  - 用户注册登录系统
  - 咖啡制作基础功能
  - 店铺管理系统
- **里程碑**：基础版本可玩

#### 第二阶段：系统完善（3周）

- **时间**：第5-7周
- **目标**：完成功能模块开发
- **交付物**：
  - 装饰系统
  - 成就系统
  - 数据统计
- **里程碑**：功能完整版本

#### 第三阶段：优化测试（2周）

- **时间**：第8-9周
- **目标**：性能优化和测试
- **交付物**：
  - 性能优化报告
  - Bug修复清单
  - 测试报告
- **里程碑**：稳定版本

#### 第四阶段：上线准备（1周）

- **时间**：第10周
- **目标**：上线部署
- **交付物**：
  - 部署文档
  - 运维手册
  - 用户手册
- **里程碑**：正式上线

### 8.2 人员配置

- **项目经理**：1人，全程参与
- **前端开发**：2人，第1-10周
- **后端开发**：2人，第1-8周
- **UI设计师**：1人，第1-4周
- **测试工程师**：1人，第7-10周

### 8.3 风险评估

- **技术风险**：性能优化可能超出预期时间（风险等级：中）
- **资源风险**：人员变动影响开发进度（风险等级：低）
- **市场风险**：竞品提前发布（风险等级：低）

---

## 9. 术语表

- **DAU**：Daily Active User，日活跃用户数
- **KPI**：Key Performance Indicator，关键绩效指标
- **QPS**：Queries Per Second，每秒查询率
- **FPS**：Frames Per Second，每秒帧数
- **JWT**：JSON Web Token，JSON网络令牌
- **API**：Application Programming Interface，应用程序编程接口
- **P0/P1/P2**：优先级等级，P0为最高优先级

---

## 10. 技术栈选型

### 10.1 前端技术栈

| 类别     | 技术选型                  | 版本要求   | 说明                                  |
| -------- | ------------------------- | ---------- | ------------------------------------- |
| 游戏引擎 | Cocos Creator             | 3.x        | 跨平台游戏引擎，支持Web、iOS、Android |
| 开发语言 | TypeScript                | 4.x        | 严格类型检查，提升代码质量            |
| UI系统   | Cocos Creator内置UI       | -          | 2D UI组件系统                         |
| 动画系统 | DragonBones               | 最新稳定版 | 骨骼动画制作                          |
| 网络请求 | HTTP + WebSocket          | -          | 游戏网络通信                          |
| 本地存储 | IndexedDB                 | -          | 用户数据本地缓存                      |
| 资源管理 | Cocos Creator资源管理系统 | -          | 动态资源加载管理                      |

### 10.2 后端技术栈

| 类别       | 技术选型     | 版本要求   | 说明                           |
| ---------- | ------------ | ---------- | ------------------------------ |
| 运行环境   | Node.js      | 18.x LTS   | 服务端JavaScript运行环境       |
| Web框架    | Koa 2.x      | 最新稳定版 | 轻量级Node.js框架              |
| 路由管理   | Koa-Router   | 最新稳定版 | Koa路由中间件                  |
| 数据库     | MongoDB      | 6.x        | 文档型数据库，存储游戏核心数据 |
| 缓存数据库 | Redis        | 7.x        | 高性能缓存，存储会话和排行榜   |
| ORM框架    | Mongoose     | 最新稳定版 | MongoDB对象模型工具            |
| 实时通信   | Socket.io    | 4.x        | WebSocket封装，支持实时交互    |
| 认证授权   | jsonwebtoken | 最新稳定版 | JWT Token生成与验证            |
| 密码加密   | bcrypt       | 最新稳定版 | 密码哈希加密                   |
| 任务队列   | Bull         | 最新稳定版 | Redis队列，处理异步任务        |
| API文档    | Swagger      | 最新稳定版 | 自动生成RESTful API文档        |
| 日志管理   | Winston      | 最新稳定版 | Node.js日志管理                |

### 10.3 数据库表结构补充

#### 10.3.1 订单数据表（orders）

| 字段名        | 类型     | 约束              | 说明     |
| ------------- | -------- | ----------------- | -------- |
| id            | ObjectId | PRIMARY KEY       | 订单ID   |
| user_id       | ObjectId | FOREIGN KEY       | 用户ID   |
| customer_type | String   | NOT NULL          | 顾客类型 |
| recipe_id     | ObjectId | NOT NULL          | 配方ID   |
| status        | String   | DEFAULT 'pending' | 订单状态 |
| created_at    | Date     | DEFAULT NOW()     | 创建时间 |
| completed_at  | Date     | -                 | 完成时间 |

#### 10.3.2 设备数据表（devices）

| 字段名       | 类型     | 约束        | 说明                        |
| ------------ | -------- | ----------- | --------------------------- |
| id           | ObjectId | PRIMARY KEY | 设备ID                      |
| user_id      | ObjectId | FOREIGN KEY | 用户ID                      |
| device_type  | String   | NOT NULL    | 设备类型（咖啡机/磨豆机等） |
| level        | Int      | DEFAULT 1   | 设备等级                    |
| upgrade_time | Date     | -           | 升级完成时间                |

#### 10.3.3 员工数据表（employees）

| 字段名        | 类型     | 约束          | 说明     |
| ------------- | -------- | ------------- | -------- |
| id            | ObjectId | PRIMARY KEY   | 员工ID   |
| user_id       | ObjectId | FOREIGN KEY   | 用户ID   |
| employee_type | String   | NOT NULL      | 员工类型 |
| skill_level   | Int      | DEFAULT 1     | 技能等级 |
| salary        | Int      | NOT NULL      | 工资     |
| hired_at      | Date     | DEFAULT NOW() | 雇佣时间 |

#### 10.3.4 装饰数据表（decorations）

| 字段名          | 类型     | 约束        | 说明     |
| --------------- | -------- | ----------- | -------- |
| id              | ObjectId | PRIMARY KEY | 装饰ID   |
| user_id         | ObjectId | FOREIGN KEY | 用户ID   |
| decoration_type | String   | NOT NULL    | 装饰类型 |
| position_x      | Float    | NOT NULL    | X坐标    |
| position_y      | Float    | NOT NULL    | Y坐标    |
| rotation        | Float    | DEFAULT 0   | 旋转角度 |
| scale           | Float    | DEFAULT 1   | 缩放比例 |

#### 10.3.5 成就数据表（achievements）

| 字段名           | 类型     | 约束          | 说明     |
| ---------------- | -------- | ------------- | -------- |
| id               | ObjectId | PRIMARY KEY   | 成就ID   |
| user_id          | ObjectId | FOREIGN KEY   | 用户ID   |
| achievement_type | String   | NOT NULL      | 成就类型 |
| progress         | Int      | DEFAULT 0     | 进度     |
| completed        | Boolean  | DEFAULT false | 是否完成 |
| completed_at     | Date     | -             | 完成时间 |

#### 10.3.6 好友关系数据表（friends）

| 字段名     | 类型     | 约束              | 说明     |
| ---------- | -------- | ----------------- | -------- |
| id         | ObjectId | PRIMARY KEY       | 关系ID   |
| user_id    | ObjectId | FOREIGN KEY       | 用户ID   |
| friend_id  | ObjectId | FOREIGN KEY       | 好友ID   |
| status     | String   | DEFAULT 'pending' | 关系状态 |
| created_at | Date     | DEFAULT NOW()     | 创建时间 |

### 10.4 部署与运维

| 类别     | 技术选型                | 说明               |
| -------- | ----------------------- | ------------------ |
| 容器化   | Docker + Docker Compose | 应用容器化部署     |
| 反向代理 | Nginx                   | 请求转发、负载均衡 |
| 进程管理 | PM2                     | Node.js进程管理    |
| CDN      | 阿里云CDN/腾讯云CDN     | 静态资源加速       |
| 监控     | Prometheus + Grafana    | 系统监控与可视化   |
| 日志系统 | ELK Stack               | 日志收集与分析     |
| CI/CD    | GitHub Actions          | 自动化部署         |

### 10.5 开发工具链

| 类别     | 工具选型          | 说明               |
| -------- | ----------------- | ------------------ |
| 版本控制 | Git + GitHub      | 代码版本管理       |
| 包管理   | npm/yarn          | 依赖管理           |
| 代码规范 | ESLint + Prettier | 代码格式与风格检查 |
| 单元测试 | Jest + Supertest  | 后端单元测试       |
| 项目管理 | Jira/Tapd/Notion  | 项目进度管理       |
| 原型设计 | Figma             | UI/UX原型设计      |
| UI设计   | Figma             | 界面设计           |

### 10.6 兼容性矩阵

| 平台    | 最低版本 | 推荐版本 |
| ------- | -------- | -------- |
| iOS     | 12.0     | 15.0+    |
| Android | 7.0      | 10.0+    |
| Chrome  | 80       | 100+     |
| Safari  | 13       | 15+      |
| Firefox | 75       | 100+     |
| Windows | 10       | 11       |
| macOS   | 10.14    | 12.0+    |

---

## 11. 版本历史

| 版本 | 日期       | 作者   | 变更内容           |
| ---- | ---------- | ------ | ------------------ |
| 1.0  | 2026-01-02 | TraeCN | 初始版本创建       |
| 1.1  | 2026-01-02 | TraeCN | 完善功能模块说明   |
| 1.2  | 2026-01-02 | TraeCN | 新增技术栈选型章节 |
